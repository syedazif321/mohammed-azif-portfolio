<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project: Multi-Floor Manipulator</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.css">
</head>
<body>
    <canvas id="fluid-canvas"></canvas>

    <main class="portfolio-container page-container">

        <a href="projects.html" class="back-link">
            <i class="fa-solid fa-arrow-left"></i>
            Back to Projects
        </a>

        <div class="project-detail-container">
            <h2>Autonomous Mobile Manipulator (Multi-Floor)</h2>

            <div class="slider-container" id="project-slider">
                <div class="slider">
                    <div class="slide">
                        <img src="media/project2/world.gif" alt="Gazebo World">
                    </div>
                    <div class="slide">
                        <img src="media/project2/pipleine1.gif" alt="Pipeline Demo">
                    </div>
                    <div class="slide">
                        <img src="media/project2/data_base.gif" alt="Database Demo">
                    </div>
                    <div class="slide">
                        <img src="media/project2/robot model.png" alt="Robot Model">
                    </div>
                    <div class="slide">
                        <img src="media/project2/top_view.png" alt="Top View">
                    </div>
                    <div class="slide">
                        <img src="media/project2/data base1.png" alt="Database Schema 1">
                    </div>
                    <div class="slide">
                        <img src="media/project2/data base2.png" alt="Database Schema 2">
                    </div>
                    <div class="slide">
                        <img src="media/project2/data base3.png" alt="Database Schema 3">
                    </div>
                </div>
                
                <button class="slider-arrow prev" id="prevBtn"><i class="fa-solid fa-chevron-left"></i></button>
                <button class="slider-arrow next" id="nextBtn"><i class="fa-solid fa-chevron-right"></i></button>
                
                <div class="dots-container" id="dotsContainer"></div>
            </div>
            <div class="project-tags">
                <span>ROS 2</span>
                <span>C++</span>
                <span>Nav2</span>
                <span>Gazebo Plugins</span>
                <span>Multi-Map Nav</span>
                <span>Perception</span>
                <span>SLAM</span>
            </div>
            
            <h3>Project Overview</h3>
            <p class="project-full-description">
                This project simulates a complex, real-world indoor logistics scenario: an autonomous mobile manipulator (AMR + 7DoF Arm + Linear Guide) designed to transport packages between floors in a multi-story environment. The system was developed entirely in C++ and ROS 2, pushing the boundaries of autonomous navigation and robot-infrastructure interaction.
            </p>

            <h3>Key Features & Technical Deep Dive</h3>
            <p class="project-full-description">
                <ul>
                    <li><strong>Multi-Floor Gazebo World:</strong> I designed and built a two-floor Gazebo environment with distinct layouts, connected by a functional elevator.</li>
                    <li><strong>Custom Lift Control Plugin:</strong> The core of this project. I wrote a C++ Gazebo plugin to simulate a working lift system. The robot could autonomously call the lift, wait for it, enter, select a floor, and exit on the second level. This required careful state management and communication within the ROS 2 framework.</li>
                    <li><strong>Dynamic Multi-Map Navigation:</strong> The robot utilized the full Nav2 stack, integrating 2D LiDAR and a depth camera for robust SLAM and obstacle avoidance. A key feature was the ability to dynamically switch maps based on its current floor, a critical requirement for multi-story autonomy.</li>
                    <li><strong>Dynamic Obstacle Simulation:</strong> To validate the Nav2 stack's robustness, I developed a Gazebo plugin to spawn, despawn, and move "human" agents unpredictably on both floors. This forced the robot to re-plan its motion in real-time.</li>
                    <li><strong>Perception-Guided Manipulation:</strong> The robot used its vision pipeline to locate packages on a rack, align itself, and deploy its linear guide to reach the correct height for a successful pick. All operation data (goal locations, lift usage, package height) was logged to a database.</li>
                </ul>
            </p>

            <a href="https://github.com/syedazif321/Autonomous-Mobile-Manipulator-in-Multi-Floor" class="btn-github" target="_blank">View on GitHub</a>
        </div>
    </main>

    <div id="imageModal" class="modal-overlay">
        <span id="modalClose" class="modal-close">&times;</span>
        <img id="modalImage" class="modal-content" src="">
    </div>
    <script src="script.js"></script>
    
<script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Slider Variables ---
            const sliderContainer = document.getElementById('project-slider');
            const slider = sliderContainer.querySelector('.slider');
            const slides = sliderContainer.querySelectorAll('.slide');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const dotsContainer = document.getElementById('dotsContainer');
            
            let currentIndex = 0;
            const slideCount = slides.length;
            let autoPlayInterval;

            // --- Modal/Lightbox Variables ---
            const modal = document.getElementById('imageModal');
            const modalImg = document.getElementById('modalImage');
            const modalClose = document.getElementById('modalClose');

            if (slideCount === 0) return; // Don't run if no slides

            // ===========================
            // SLIDER FUNCTIONS
            // ===========================

            // 1. Create Dots
            function createDots() {
                for (let i = 0; i < slideCount; i++) {
                    const dot = document.createElement('span');
                    dot.classList.add('dot');
                    dot.dataset.index = i;
                    dotsContainer.appendChild(dot);
                }
            }

            // 2. Update Slider Position and Dots
            function goToSlide(index) {
                if (index < 0) {
                    currentIndex = slideCount - 1;
                } else if (index >= slideCount) {
                    currentIndex = 0;
                } else {
                    currentIndex = index;
                }
                slider.style.transform = `translateX(-${currentIndex * 100}%)`;
                const dots = dotsContainer.querySelectorAll('.dot');
                dots.forEach(dot => dot.classList.remove('active'));
                dots[currentIndex].classList.add('active');
            }

            // 3. Navigation Functions
            function nextSlide() { goToSlide(currentIndex + 1); }
            function prevSlide() { goToSlide(currentIndex - 1); }

            // 4. Autoplay
            function startAutoPlay() {
                autoPlayInterval = setInterval(nextSlide, 5000); // 5 seconds
            }

            function resetAutoPlay() {
                clearInterval(autoPlayInterval);
                startAutoPlay();
            }

            // 5. Slider Event Listeners
            nextBtn.addEventListener('click', () => {
                nextSlide();
                resetAutoPlay();
            });

            prevBtn.addEventListener('click', () => {
                prevSlide();
                resetAutoPlay();
            });

            dotsContainer.addEventListener('click', (e) => {
                if (e.target.classList.contains('dot')) {
                    const index = parseInt(e.target.dataset.index, 10);
                    goToSlide(index);
                    resetAutoPlay();
                }
            });

            sliderContainer.addEventListener('mouseenter', () => clearInterval(autoPlayInterval));
            sliderContainer.addEventListener('mouseleave', startAutoPlay);

            // ===========================
            // LIGHTBOX/MODAL FUNCTIONS
            // ===========================

            function openModal(e) {
                const imgSource = e.currentTarget.querySelector('img').src;
                modalImg.src = imgSource;
                modal.style.display = "flex";
                clearInterval(autoPlayInterval); // Pause slider

                // --- 1. REMOVE the "if (!imgSource.endsWith('.gif'))" check ---
                
                // Clean up any old zoom instance
                if (currentPanzoomInstance) {
                    currentPanzoomInstance.dispose();
                    currentPanzoomInstance = null;
                }

                // Initialize panzoom on the image (NOW works on GIFs too)
                currentPanzoomInstance = panzoom(modalImg, {
                    maxScale: 5,        // Max zoom 5x
                    minScale: 1,        // Min zoom 100%
                    contain: 'outside'  // Keep image centered
                });
                modalImg.classList.add('zoomable');
                // --- End of new logic ---
            }

            // 2. Close Modal
            function closeModal() {
                modal.style.display = "none";
                modalImg.src = ""; // Clear src
                startAutoPlay(); // Resume slider
            }

            // 3. Modal Event Listeners
            slides.forEach(slide => {
                slide.addEventListener('click', openModal);
                slide.style.cursor = 'pointer'; // Show it's clickable
            });

            modalClose.addEventListener('click', closeModal);
            modal.addEventListener('click', (e) => {
                // Close if user clicks on the dark overlay (but not the image itself)
                if (e.target === modal) {
                    closeModal();
                }
            });

            // ===========================
            // INITIALIZATION
            // ===========================
            createDots();
            goToSlide(0); // Set initial slide
            startAutoPlay();
        });
    </script>
    </body>
</html>